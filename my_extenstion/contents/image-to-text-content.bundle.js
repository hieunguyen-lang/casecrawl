(()=>{"use strict";const e={API_KEY:{key:"api_key",defaultValue:""},POWER_ON:{key:"power_on",defaultValue:!0},TIKTOK:{key:"tiktok",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},FUNCAPTCHA:{key:"funcaptcha",defaultValue:{delayClick:100,loop:!0,isActive:!0,maxImageCaptcha:1e4}},ZALO:{key:"zalo",defaultValue:{delayClick:100,loop:!0,isActive:!0}},SHOPEE:{key:"shopee",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},RECAPTCHAV2:{key:"reCaptchav2",defaultValue:{delayClick:500,loop:!0,isActive:!0,useToken:!1}},AMZN:{key:"amzn",defaultValue:{delayClick:100,loop:!0,isActive:!0}},GEETEST:{key:"geetest",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},GARENA:{key:"garena",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}}};async function t(e,t,a){const o="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{return await new Promise(((r,n)=>{o.sendMessage({source:e,type:t,data:a},(e=>{o.lastError?n(new Error(`Error sending message: ${o.lastError.message}`)):r(e)}))}))}catch(e){throw console.error(`[messageHelpers] Error in sending message: ${e.message}`),e}}const a=async(e,t)=>{const a="undefined"!=typeof browser?browser.storage.local:chrome.storage.local,o="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{const r=await a.get([e]);if(o.lastError)throw new Error(`Error retrieving ${e}: ${o.lastError.message}`);return null!=r[e]?r[e]:t}catch(t){throw console.error(`[storageHelpers] Error retrieving ${e}:`,t),t}};Promise.resolve();async function o(e){return new Promise((t=>setTimeout(t,e)))}async function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{timeout:5e3,maxRetries:3};try{const{timeout:a,maxRetries:r}=t,n={arkoselabs:"image/jpeg"};function c(e){for(const[t,a]of Object.entries(n))if(e.includes(t))return a;return"image/png"}if(e instanceof HTMLCanvasElement||e.tagName&&"CANVAS"===e.tagName.toUpperCase())try{if(0===e.width||0===e.height)return console.log("Canvas rỗng hoặc không có kích thước"),"";const i=e.getBoundingClientRect(),s=i.width,l=i.height,u=document.createElement("canvas");u.width=s,u.height=l;u.getContext("2d").drawImage(e,0,0,s,l);const g="image/png",m=u.toDataURL(g).split(",")[1];return m||(console.log("Không thể lấy base64 từ canvas"),"")}catch(h){return console.log("Lỗi khi chụp màn hình canvas:",h),""}if(e instanceof Element)try{const d=e.src;if(d&&d.startsWith("data:image/")){const p=d.split(",")[1];return p||(console.log("Base64 rỗng từ src của element"),"")}e=d||""}catch(f){return console.log("Lỗi khi xử lý element:",f),""}if("string"==typeof e&&e.startsWith("blob:")){console.log("Da vao blob");try{return await new Promise((t=>{const a=new Image;a.setAttribute("crossOrigin","anonymous");const o=setTimeout((()=>{t("")}),1e3);a.onload=function(){console.log("Vao trong onload"),clearTimeout(o);try{const a=document.createElement("canvas");a.width=this.naturalWidth,a.height=this.naturalHeight;a.getContext("2d").drawImage(this,0,0);const o=c(e);a.toBlob((e=>{if(!e)return void t("");const a=new FileReader;a.onloadend=()=>{const e=a.result.split(",")[1];t(e)},a.onerror=()=>t(""),a.readAsDataURL(e)}),o)}catch(e){console.log("Lỗi khi xử lý blob URL:",e),t("")}},a.onerror=()=>{clearTimeout(o),t("")},a.src=e,console.log("This is img:"),console.log("img src:",a.src)}))}catch(w){return console.log("Lỗi khi xử lý blob URL:",w),""}}if("string"==typeof e){console.log("Vao den input string:");try{for(let y=0;y<r;y++)try{const k=new AbortController,I=setTimeout((()=>k.abort()),a),T=await fetch(e,{signal:k.signal});if(clearTimeout(I),!T.ok)throw new Error(`HTTP error ${T.status}`);const b=await T.blob();return await new Promise(((e,t)=>{const a=new FileReader;a.onloadend=()=>e(a.result.split(",")[1]),a.onerror=()=>t(new Error("Failed to read blob as base64")),a.readAsDataURL(b)}))}catch(E){if(y===r-1)return console.log("Hết lượt thử fetch:",E),"";await o(500)}}catch(v){return console.log("Lỗi khi fetch URL:",v),""}}return console.log("Đầu vào không được hỗ trợ:",e),""}catch(S){return console.log("Lỗi chung trong fetchImageToBase64:",S),""}}function n(e,t){return new Promise((a=>{const o=Date.now(),r=setInterval((()=>{for(const t of e){if(document.querySelector(t))return clearInterval(r),void a(!0)}Date.now()-o>=t&&(clearInterval(r),a(!1))}),500)}))}const c=window.location.hostname,i={"www.facebook.com":{captchaImageSelector:'img[src*="/captcha/"]',inputSelector:'input[id*="«r1»"]'},"signin.aws.amazon.com":{captchaImageSelector:'[class*="awsui_child"] img[id*="captcha_image"]',inputSelector:'[class*="awsui"] input[class*="awsui_input"]'},"2captcha.com":{captchaImageSelector:'img[class*="_captchaImage"]',inputSelector:'input[id*="simple-captcha-field"]'},"demos.telerik.com":{captchaImageSelector:'img[id*="_CaptchaImage"]',inputSelector:'input[class*="rfdTextInput"]'},"captcha.com":{captchaImageSelector:'img[id*="demoCaptcha_CaptchaImage"]',inputSelector:'input[id*="captchaCode"]'},"svnckh.huit.edu.vn":{captchaImageSelector:'img[id*="imgCaptcha"]',inputSelector:'input[name*="captchaCode"]'},"register.rediff.com":{captchaImageSelector:'[class="captchaImageCnt"] img[class*="captchaImage"]',inputSelector:'form[name*="register_mail"] input[class*="captcha"]'},"iforgot.apple.com":{captchaImageSelector:'[class="idms-captcha-wrapper"] [class*="img-wrapper"] img',inputSelector:'[class*="captcha-input-container"] input[class*="captcha-input"]'}}[c];let s,l;console.log("Day la hostname:",c),i||console.log("Không có config cho trang:",c),console.log("Run file ImageToText",window.location.href);let u=!1,g="",m=!1;async function h(){if(m)return;console.log("Running captchaImageToText");const e=document.querySelector(i.inputSelector);if(!e)return;let a=null;for(let e=0;e<10&&(a=document.querySelector(i.captchaImageSelector),!a);e++)await o(1e3);if(!a)return;let n="";for(let e=0;e<10;e++){switch(c){case"signin.aws.amazon.com":n=await t("IMAGETOTEXT","createImageBase64",{url:a.src});break;case"register.rediff.com":n=d(a);break;default:n=await r(a)}if(n&&n!==g){g=n;break}await o(1e3)}if(!n)return;console.log("Day la base64",n);const s=await async function(e){const a=JSON.stringify({clientKey:l,task:e});try{const e=await t("IMAGETOTEXT","createTask",a);return e||(console.error("[imagetotext] No taskId returned from createTask"),"")}catch(e){return console.error("[imagetotext] Failed to create task:",e),""}}({type:"ImageToTextTask",imageBase64:n});if(!s)return;const u=await async function(e,a){const o=JSON.stringify({clientKey:l,taskId:e});try{const e=await t("IMAGETOTEXT","getTaskResult",{data:o,timeWait:a});return e?"fail"===e.status?(console.error("[imagetotext] API error:",e),null):e.solution?e.solution:(console.error("[imagetotext] Invalid API response: missing solution"),null):(console.error("[imagetotext] No result returned from getTaskResult"),null)}catch(e){return console.error("[imagetotext] Failed to get task result:",e),null}}(s,20);u&&(e.value=u.text,e.dispatchEvent(new Event("input",{bubbles:!0})),m=!0,console.log("Captcha solved successfully, stop solving."))}function d(e){try{const t=document.createElement("canvas");t.width=e.naturalWidth,t.height=e.naturalHeight;return t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png").replace(/^data:image\/png;base64,/,"")}catch(e){return console.error("Lỗi khi xử lý ảnh bằng canvas:",e),""}}(async()=>{await async function(){s=await a(e.POWER_ON.key,e.POWER_ON.defaultValue),l=await a(e.API_KEY.key,e.API_KEY.defaultValue)}();new MutationObserver((async(e,t)=>{await async function(e){if(s&&l&&"YOUR_CLIEN_KEY"!==l&&i&&!m)for(const t of e)if("childList"===t.type&&document.querySelector(i.captchaImageSelector)&&!u){u=!0,await o(1500);try{if(!await n([i.captchaImageSelector],1e4))return;document.querySelector(i.captchaImageSelector)&&await h()}catch(e){console.error("Lỗi captchaImageToText:",e)}finally{u=!1}}}(e)})).observe(document.body,{childList:!0,subtree:!0})})()})();