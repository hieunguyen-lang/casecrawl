(()=>{"use strict";const e={API_KEY:{key:"api_key",defaultValue:""},POWER_ON:{key:"power_on",defaultValue:!0},TIKTOK:{key:"tiktok",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},FUNCAPTCHA:{key:"funcaptcha",defaultValue:{delayClick:100,loop:!0,isActive:!0,maxImageCaptcha:1e4}},ZALO:{key:"zalo",defaultValue:{delayClick:100,loop:!0,isActive:!0}},SHOPEE:{key:"shopee",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},RECAPTCHAV2:{key:"reCaptchav2",defaultValue:{delayClick:500,loop:!0,isActive:!0,useToken:!1}},AMZN:{key:"amzn",defaultValue:{delayClick:100,loop:!0,isActive:!0}},GEETEST:{key:"geetest",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},GARENA:{key:"garena",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}}};async function t(e,t,r){const o="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{return await new Promise(((n,a)=>{o.sendMessage({source:e,type:t,data:r},(e=>{o.lastError?a(new Error(`Error sending message: ${o.lastError.message}`)):n(e)}))}))}catch(e){throw console.error(`[messageHelpers] Error in sending message: ${e.message}`),e}}const r=async(e,t)=>{const r="undefined"!=typeof browser?browser.storage.local:chrome.storage.local,o="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{const n=await r.get([e]);if(o.lastError)throw new Error(`Error retrieving ${e}: ${o.lastError.message}`);return null!=n[e]?n[e]:t}catch(t){throw console.error(`[storageHelpers] Error retrieving ${e}:`,t),t}};Promise.resolve();async function o(e){return new Promise((t=>setTimeout(t,e)))}let n,a,s,i,l;console.log("Run shopee...",window.location.href);let c=!1;async function u(){console.log("[shopee] Da den captchaSlide()");for(var e="",t=0;t<30;t++){await o(1e3);var r=document.querySelector('[role="dialog"] img[draggable="false"]');if(r&&e!==r.src){e=r.src;var n=document.querySelector('[role="dialog"] img[draggable="true"]');const t=await y(e,n.src);if(""===t){if(i){await g(n,1);continue}}else{const r=await m(t,30);if("Server 500"===r){e="";continue}if(""===r&&i){await g(n,1);continue}let o=parseInt(r.end.x,10);if(await g(n,o),!i)return}}}}function d(e){return!!document.querySelector(e)}async function f(e,t){const r=Date.now()+t;for(;Date.now()<r;){for(const t of e){if(document.querySelector(t))return!0}await o(500)}return!1}function g(e,t){return new Promise(((r,o)=>{if(!e)return console.error("Element not found"),void o("Element not found");function n(){const t=e.getBoundingClientRect();return{centerX:t.left+t.width/2,centerY:t.top+t.height/2}}const a=new DataTransfer;function s(t,r,o){const n={bubbles:!0,cancelable:!0,clientX:r,clientY:o,dataTransfer:a,...arguments.length>3&&void 0!==arguments[3]?arguments[3]:{}},s=t.includes("drag")?new DragEvent(t,n):new MouseEvent(t,n);e.dispatchEvent(s)}const i=n(),l=i.centerX+t;s("pointerenter",i.centerX,i.centerY),s("mouseover",i.centerX,i.centerY),s("mousedown",i.centerX,i.centerY),s("dragstart",i.centerX,i.centerY);let c=i.centerX,u=10,d=3;!function e(){const o=n();if(Math.abs(o.centerX-l)<=1)return void setTimeout((()=>{s("dragend",o.centerX,o.centerY),s("mouseup",o.centerX,o.centerY),r()}),1e3);l-o.centerX>t/4?(u=10,d=3):(u=1,d=10),c+=u*Math.sign(l-o.centerX);const a=o.centerY;s("mousemove",c,a),s("drag",c,a),setTimeout(e,d)}()}))}async function y(e,r){const o=JSON.stringify({clientKey:a,task:{type:"ShopeeSliderWebTask",imageBase64s:[e,r]}});try{const e=await t("SHOPEE","createTask",o);return e||(console.error("[shopee] No taskId returned from createTask"),"")}catch(e){return console.error("[shopee] Failed to create task:",e),""}}async function m(e,r){const o=JSON.stringify({clientKey:a,taskId:e});try{const e=await t("SHOPEE","getTaskResult",{data:o,timeWait:r});return e?"fail"===e.status?(console.error("[shopee] API error:",e),null):e.solution&&e.solution.end?e.solution:(console.error("[shopee] Invalid API response: missing solution or end"),""):(console.error("[shopee] No result returned from getTaskResult"),"")}catch(e){return console.error("[shopee] Failed to get task result:",e),""}}new MutationObserver((async(e,t)=>{await async function(e){if(n&&l&&a&&"YOUR_CLIEN_KEY"!==a){console.log("[shopee] handleElementMutation");for(const t of e)if("childList"===t.type)if(document.querySelector('[role="dialog"] [aria-label*="CAPTCHA" i]')){if(console.log("[shopee] Tim thay targetElement"),!c){if(!a)return;c=!0,await o(1e3),f(['[role="dialog"] img[draggable="false"]','[role="dialog"] img[draggable="true"]'],1e4).then((async e=>{if(e)for(var t=0;t<20;t++){if(d('[role="dialog"] img[draggable="false"]')&&d('[role="dialog"] img[draggable="true"]')){await u();break}await o(500)}}))}}else console.log("[shopee] Khong tim thay targetElement"),c=!1}}(e)})).observe(document.body,{childList:!0,subtree:!0}),(async()=>{await async function(){n=await r(e.POWER_ON.key,e.POWER_ON.defaultValue),a=await r(e.API_KEY.key,e.API_KEY.defaultValue);const t=await r(e.SHOPEE.key,e.SHOPEE.defaultValue);s=t.delaySwipe,i=t.loop,l=t.isActive}()})()})();