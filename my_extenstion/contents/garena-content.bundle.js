(()=>{"use strict";const e={API_KEY:{key:"api_key",defaultValue:""},POWER_ON:{key:"power_on",defaultValue:!0},TIKTOK:{key:"tiktok",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},FUNCAPTCHA:{key:"funcaptcha",defaultValue:{delayClick:100,loop:!0,isActive:!0,maxImageCaptcha:1e4}},ZALO:{key:"zalo",defaultValue:{delayClick:100,loop:!0,isActive:!0}},SHOPEE:{key:"shopee",defaultValue:{delaySwipe:15,loop:!0,isActive:!0}},RECAPTCHAV2:{key:"reCaptchav2",defaultValue:{delayClick:500,loop:!0,isActive:!0,useToken:!1}},AMZN:{key:"amzn",defaultValue:{delayClick:100,loop:!0,isActive:!0}},GEETEST:{key:"geetest",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}},GARENA:{key:"garena",defaultValue:{delayClick:500,delaySwipe:15,loop:!0,isActive:!0}}};async function t(e,t,a){const n="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{return await new Promise(((o,r)=>{n.sendMessage({source:e,type:t,data:a},(e=>{n.lastError?r(new Error(`Error sending message: ${n.lastError.message}`)):o(e)}))}))}catch(e){throw console.error(`[messageHelpers] Error in sending message: ${e.message}`),e}}const a=async(e,t)=>{const a="undefined"!=typeof browser?browser.storage.local:chrome.storage.local,n="undefined"!=typeof browser?browser.runtime:chrome.runtime;try{const o=await a.get([e]);if(n.lastError)throw new Error(`Error retrieving ${e}: ${n.lastError.message}`);return null!=o[e]?o[e]:t}catch(t){throw console.error(`[storageHelpers] Error retrieving ${e}:`,t),t}};Promise.resolve();async function n(e){return new Promise((t=>setTimeout(t,e)))}function o(e,t){return new Promise((a=>{const n=Date.now(),o=setInterval((()=>{for(const t of e){if(document.querySelector(t))return clearInterval(o),void a(!0)}Date.now()-n>=t&&(clearInterval(o),a(!1))}),500)}))}function r(e,t){return new Promise((a=>{const n=document.querySelector(e);if(n)return a(n);const o=new MutationObserver(((t,n)=>{const o=document.querySelector(e);o&&(n.disconnect(),a(o))}));o.observe(document.body,{childList:!0,subtree:!0}),setTimeout((()=>{o.disconnect(),a(null)}),t)}))}let c,l,s,i,u,d;async function m(){c=await a(e.POWER_ON.key,e.POWER_ON.defaultValue),l=await a(e.API_KEY.key,e.API_KEY.defaultValue);const t=await a(e.GARENA.key,e.GARENA.defaultValue);s=t.delayClick,i=t.delaySwipe,u=t.loop,d=t.isActive}console.log("Run file Garena",window.location.href);let y=!1,f="";async function g(){console.log("abc")}async function p(){for(console.log("This is captchaKeoTha");;){await n(500);var e=null;for(let t=0;t<10&&null==(e=document.querySelector('[id="captcha__element"] [id="captcha__puzzle"]>canvas'));t++)await n(1e3);if(!e)return;let a="";for(let e=0;e<10;e++){if(a=h(),a&&f!==a){f=a;break}await n(1e3)}if(!a)return;console.log("This is imgBase64>>>",a);const o={type:"GeetestSliderWebTask",imageBase64:a},c=await v(o);c||console.log("Ko có taskId");const l=await k(c,30);console.log("Day la result>>>",l),l||console.log("Ko có result");let s=parseInt(l.end.x,10);var t=document.querySelector('[id="captcha__frame__bottom"] [class*="sliderContainer"] div[class="slider"]');if(await E(t,s),u){if(await r('[class*="geetest_lock_success"]',5e3)){console.log("Giải captcha thành công");break}console.log("Giải captcha thất bại")}}}function w(e){return!!document.querySelector(e)}function h(){const e=document.querySelectorAll("#captcha__puzzle canvas"),t=e[0],a=e[1],n=document.createElement("canvas");n.width=280,n.height=155;const o=n.getContext("2d");o.drawImage(t,0,0),o.drawImage(a,0,0);const r=n.toDataURL("image/png"),c=r.replace(/^data:image\/png;base64,/,"");return console.log("Base64 đầy đủ:\n",r),console.log("Base64 chỉ phần mã hóa:\n",c),c}async function E(e,t){return new Promise((a=>{if(!e)return a();e.parentElement;const o=t,r=new DataTransfer,c=i;function l(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.dispatchEvent(new MouseEvent(t,{bubbles:!0,cancelable:!0,...a})),e.dispatchEvent(new PointerEvent(t,{bubbles:!0,cancelable:!0,...a,pointerType:"mouse",isPrimary:!0}))}(async()=>{l("mouseenter"),l("mouseover"),await n(c),l("pointerdown",{clientX:0,clientY:0}),l("mousedown",{clientX:0,clientY:0}),e.dispatchEvent(new DragEvent("dragstart",{bubbles:!0,cancelable:!0,dataTransfer:r}));let s=0,i=0;for(;s+10<t;){const e=s/t;let a;a=e<.3?2*Math.random()+1:e<.7?6*Math.random()+2:2*Math.random()+.5,s+=a,i+=8*(Math.random()-.5);const r=Math.min(s,o),u=i;l("mousemove",{clientX:r,clientY:u}),l("pointermove",{clientX:r,clientY:u}),await n(c)}s=t;const u=i;l("mousemove",{clientX:s,clientY:u}),l("pointermove",{clientX:s,clientY:u}),await n(c),l("pointerup",{clientX:s,clientY:u}),l("mouseup",{clientX:s,clientY:u}),e.dispatchEvent(new DragEvent("dragend",{bubbles:!0,cancelable:!0,dataTransfer:r})),console.log("Vị trí backend >>>",t),console.log(`Vị trí cuối cùng của element: x = ${s}, y = ${u}`),a()})()}))}async function v(e){const a=JSON.stringify({clientKey:l,task:e});try{const e=await t("GEETEST","createTask",a);return e||(console.error("[geetest] No taskId returned from createTask"),"")}catch(e){return console.error("[geetest] Failed to create task:",e),""}}async function k(e,a){const n=JSON.stringify({clientKey:l,taskId:e});try{const e=await t("GEETEST","getTaskResult",{data:n,timeWait:a});return e?"fail"===e.status?(console.error("[geetest] API error:",e),null):e.solution?e.solution:(console.error("[geetest] Invalid API response: missing solution"),null):(console.error("[geetest] No result returned from getTaskResult"),null)}catch(e){return console.error("[geetest] Failed to get task result:",e),null}}(async()=>{await m();new MutationObserver((async(e,t)=>{await async function(e){if(console.log("Đã vào [Garena] handleElementMutation"),await m(),c&&d&&l&&"YOUR_CLIEN_KEY"!==l)for(const t of e)if("childList"===t.type){if(!document.querySelector('[id="captcha__frame"] [id="captcha__element"]')||y)continue;if(console.log("Da thay targetElement"),!l)return;y=!0;try{if(await n(1500),!await o(['[id="captcha__element"] [id="captcha__puzzle"] canvas'],1e4))return;console.log("Tìm thấy elementExists");for(let e=0;e<20;e++){if(w(".abc")){await g();break}if(w('[id="captcha__element"] [id="captcha__puzzle"] canvas[class="block"]')){console.log("Tìm thấy captchaKeoTha"),await p();break}await n(1e3)}}finally{y=!1}}}(e)})).observe(document.body,{childList:!0,subtree:!0})})()})();